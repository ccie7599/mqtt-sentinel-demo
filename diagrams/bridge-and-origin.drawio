<mxfile host="app.diagrams.net" modified="2026-02-03" agent="draw.io" type="device">
  <diagram id="bridge-origin" name="Bridge Service and Customer Origin">
    <mxGraphModel dx="1422" dy="762" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="MQTT Sentinel — Bridge Service &amp; Customer Origin" style="text;html=1;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="300" y="10" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- Core Broker output -->
        <mxCell id="broker-out" value="Core Broker&#xa;(inspected, buffered messages)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;fontColor=#2d5016;" vertex="1" parent="1">
          <mxGeometry x="40" y="160" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Bridge Service -->
        <mxCell id="bridge-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="70" width="400" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bridge-title" value="Bridge Service" style="text;html=1;fontSize=15;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="315" y="75" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bridge-subtitle" value="Protocol Conversion &amp; Origin Delivery" style="text;html=1;fontSize=11;fontStyle=2;align=left;fillColor=none;strokeColor=none;fontColor=#999900;" vertex="1" parent="1">
          <mxGeometry x="315" y="100" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="bridge-mqtt-in" value="MQTT&#xa;Subscriber" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6a800;fontColor=#ffffff;strokeColor=#a68500;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="135" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bridge-convert" value="Protocol&#xa;Converter&#xa;(MQTT → WS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6a800;fontColor=#ffffff;strokeColor=#a68500;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="205" width="110" height="55" as="geometry" />
        </mxCell>
        <mxCell id="bridge-ws-out" value="WebSocket&#xa;Publisher" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6a800;fontColor=#ffffff;strokeColor=#a68500;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="280" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- Bridge features -->
        <mxCell id="bf1" value="Auto-reconnection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#d6b656;fontSize=10;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="480" y="135" width="190" height="28" as="geometry" />
        </mxCell>
        <mxCell id="bf2" value="QoS 1 delivery guarantee" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#d6b656;fontSize=10;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="480" y="173" width="190" height="28" as="geometry" />
        </mxCell>
        <mxCell id="bf3" value="Topic transformation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#d6b656;fontSize=10;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="480" y="211" width="190" height="28" as="geometry" />
        </mxCell>
        <mxCell id="bf4" value="Exponential backoff retry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#d6b656;fontSize=10;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="480" y="249" width="190" height="28" as="geometry" />
        </mxCell>
        <mxCell id="bf5" value="Prometheus metrics export" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#d6b656;fontSize=10;fontColor=#7a6000;" vertex="1" parent="1">
          <mxGeometry x="480" y="287" width="190" height="28" as="geometry" />
        </mxCell>

        <!-- Bridge internal arrows -->
        <mxCell id="b-arr1" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=1;strokeColor=#a68500;" edge="1" parent="1" source="bridge-mqtt-in" target="bridge-convert">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="b-arr2" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=1;strokeColor=#a68500;" edge="1" parent="1" source="bridge-convert" target="bridge-ws-out">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Broker to Bridge arrow -->
        <mxCell id="broker-bridge-arrow" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=3;strokeColor=#82b366;" edge="1" parent="1" source="broker-out" target="bridge-bg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="broker-bridge-label" value="MQTT" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#82b366;fontStyle=1;labelBackgroundColor=#ffffff;" vertex="1" connectable="0" parent="broker-bridge-arrow">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- KEY BENEFIT callout -->
        <mxCell id="benefit-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="70" width="300" height="140" as="geometry" />
        </mxCell>
        <mxCell id="benefit-title" value="Origin Protection" style="text;html=1;fontSize=14;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="760" y="75" width="280" height="25" as="geometry" />
        </mxCell>
        <mxCell id="benefit-text" value="By converting MQTT to WebSockets,&#xa;traffic can pass through the customer's&#xa;existing WAF (Akamai / F5) for&#xa;application-layer inspection.&#xa;&#xa;No direct MQTT exposure to origin." style="text;html=1;fontSize=11;align=left;fillColor=none;strokeColor=none;fontColor=#555555;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="760" y="100" width="280" height="100" as="geometry" />
        </mxCell>

        <!-- Internet / WAN -->
        <mxCell id="internet" value="Internet / WAN" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="410" y="380" width="190" height="80" as="geometry" />
        </mxCell>

        <!-- Bridge to Internet -->
        <mxCell id="bridge-internet" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=3;strokeColor=#cc6600;" edge="1" parent="1" source="bridge-bg" target="internet">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bridge-internet-label" value="WSS (TLS)" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#cc6600;fontStyle=1;labelBackgroundColor=#ffffff;" vertex="1" connectable="0" parent="bridge-internet">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Customer WAF -->
        <mxCell id="waf-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="510" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="waf-title" value="Customer WAF (Akamai / F5)" style="text;html=1;fontSize=14;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#7a1a1a;" vertex="1" parent="1">
          <mxGeometry x="310" y="515" width="380" height="25" as="geometry" />
        </mxCell>
        <mxCell id="waf-detail" value="WebSocket traffic inspection  |  DDoS mitigation  |  Bot detection  |  Geo-blocking" style="text;html=1;fontSize=10;align=center;fillColor=none;strokeColor=none;fontColor=#994444;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="310" y="545" width="380" height="25" as="geometry" />
        </mxCell>

        <!-- Internet to WAF -->
        <mxCell id="internet-waf" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=3;strokeColor=#b85450;" edge="1" parent="1" source="internet" target="waf-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Customer Origin -->
        <mxCell id="origin-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff5f5;strokeColor=#cc0000;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="640" width="600" height="130" as="geometry" />
        </mxCell>
        <mxCell id="origin-title" value="Customer Origin" style="text;html=1;fontSize=15;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="215" y="645" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="origin-envoy" value="Envoy&#xa;Proxy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cc0000;fontColor=#ffffff;strokeColor=#990000;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="250" y="690" width="120" height="55" as="geometry" />
        </mxCell>
        <mxCell id="origin-mosquitto" value="Mosquitto&#xa;Broker" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cc0000;fontColor=#ffffff;strokeColor=#990000;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="690" width="120" height="55" as="geometry" />
        </mxCell>
        <mxCell id="origin-percona" value="PerconaDB" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#cc0000;fontColor=#ffffff;strokeColor=#990000;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="685" width="120" height="65" as="geometry" />
        </mxCell>

        <!-- Origin internal arrows -->
        <mxCell id="o-arr1" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#990000;" edge="1" parent="1" source="origin-envoy" target="origin-mosquitto">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- WAF to Origin -->
        <mxCell id="waf-origin" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=3;strokeColor=#cc0000;" edge="1" parent="1" source="waf-box" target="origin-bg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="waf-origin-label" value="WSS → Envoy" style="edgeLabel;html=1;align=center;verticalAlign=middle;fontSize=10;fontColor=#cc0000;fontStyle=1;labelBackgroundColor=#ffffff;" vertex="1" connectable="0" parent="waf-origin">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Auth callout annotation -->
        <mxCell id="auth-note" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5c6bc0;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="850" y="510" width="300" height="100" as="geometry" />
        </mxCell>
        <mxCell id="auth-note-title" value="Auth Callout Path" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#3949ab;" vertex="1" parent="1">
          <mxGeometry x="860" y="515" width="280" height="20" as="geometry" />
        </mxCell>
        <mxCell id="auth-note-text" value="The Proxy Layer authenticates devices&#xa;by calling out to the customer's&#xa;PerconaDB in their origin. Auth results&#xa;are cached (60s TTL) at the proxy." style="text;html=1;fontSize=10;align=left;fillColor=none;strokeColor=none;fontColor=#555555;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="860" y="540" width="280" height="60" as="geometry" />
        </mxCell>

        <!-- Auth arrow from note to PerconaDB -->
        <mxCell id="auth-arrow" value="" style="endArrow=open;endFill=0;html=1;strokeWidth=1;strokeColor=#5c6bc0;dashed=1;" edge="1" parent="1" source="auth-note" target="origin-percona">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
